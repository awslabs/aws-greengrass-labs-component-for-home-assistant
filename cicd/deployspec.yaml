# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0

version: 0.2

phases:
  pre_build:
    commands:
      # Log the versions of all tools
      - python3 --version
      - jq --version
  
  build:
    commands:
      # Get the recipe file generated by the build stage
      - RECIPE_FILE=$(ls $CODEBUILD_SRC_DIR_Build/*.json)

      # Extract the component version
      - COMPONENT_VERSION=$(cat $RECIPE_FILE | jq -r '.ComponentVersion')

      # Create a component version
      - python3 deploy_component_version.py $COMPONENT_VERSION $AWS_REGION $GREENGRASS_CORE_NAME

  post_build:
    commands:
